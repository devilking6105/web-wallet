<template>

    <require from="components/modal-dialog"></require>

    <div class="wallet-init-overlay"></div>

    <div class="wallet-init-aside">
        <div class="aside-bg"></div>
        <div class="container h-100">
            <div class="row h-100">
                <div class="col-12 h-100 my-auto">
                    <div class="aside-content text-white py-5 py-md-0">
                        <img src="images/Beet_R1.png" width="380px" alt="Logo" style="margin-left: -8px; margin-top: -8px;">
                        <!-- <h1 class="mb-3">Beetle Coin</h1> -->
                        <p class="mb-4" style="margin-top: -25px;">
                            <strong>Welcome to the Beetle Coin Web Wallet.</strong> <br/>
                        </p>
                        <p>
                            All keys and phrases generated by this application is done on-demand, in your browser. At no point do
                            we transfer any keys across the web, use them in API calls, or store them on any of our servers. All your
                            sensitive information remain private, and is not entrusted to any 3rd party, including us. While this ensures
                            a strong level of security, it also means that we CANNOT recover your keys, pass phrase or wallet, even if we
                            wanted to. So please make a backup of the pass phrase generated for you.<br/><br/>
                            Note that this application requires, by definition, a modern Javascript enabled browser. The only way
                            to support older browsers is by moving functionality to a server, in order to render simpler views.
                            But that would mean transfering your keys there as well.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="wallet-init-content">

        <div class="container-fluid text-right">
            <div class="header">
                <h3 class="display-4">You do not currently have a wallet configured.</h3>
                <div class="subheader">How would you like to proceed?</div>
            </div>
        </div>

        <hr/>

        <form>

            <div style="padding-top: 20px; padding-bottom: 20px;">
                <div class="row">
                    <div class="col-sm-7">
                        <div class="form-group">
                            <select class="form-control" value.bind="selectedAction" change.delegate="actionSelected()">
                                <option value="generate_wallet">I want to generate a new wallet</option>
                                <option value="recover_wallet">I want to recover an existing wallet using a pass phrase &nbsp;</option>
                            </select>
                        </div>
                    <div class="col-sm-5">
                    </div>
                </div>


            </div>

            <div show.bind="isGeneratingNewWallet || isRecoveringExistingWallet">

                <div class="row">
                    <div class="col-sm-7">
                        <div class="form-group">
                            <label for="password">Site Password: <i id="password_help" class="fa fa-question-circle fa-lg help" style="font-size: 28px; padding-top: 4px;"></i></label>
                            <input type="password" class="form-control ${passwordSatisfiesPolicy ? '' : 'is-invalid'}" id="password" value.bind="password" input.delegate="validatePassword($event) & debounce:200">
                        </div>
                    </div>
                    <div class="col-sm-5">
                        <!-- <span class="text-danger" show.bind="_error">${_error} &nbsp;</span><span class="text-danger">&nbsp;</span> -->
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-7">
                        <div class="form-group">
                            <label for="confirm_password">Confirm Password: </label>
                            <input type="password" class="form-control ${passwordsMatch ? '' : 'is-invalid'}" id="confirm_password" value.bind="cpassword" input.delegate="validatePasswordsMatch($event) & debounce:200">
                        </div>
                    </div>
                    <div class="col-sm-5">

                    </div>
                </div>

            </div>

            <div show.bind="isRecoveringExistingWallet">
                <div class="form-group">
                    <label for="existing_pass_phrase">Wallet Pass Phrase: <i id="passphrase_help" class="fa fa-question-circle fa-lg help" style="font-size: 28px; padding-top: 4px;"></i></label>
                    <input type="text" class="form-control ${isValidPassPhrase ? '' : 'is-invalid'}" id="existing_pass_phrase" value.bind="passphrase" input.delegate="validatePassPhrase($event) & debounce:200">
                </div>
            </div>

            <div show.bind="isGenerationParamsValid && walletGenerationSucceeded">

                <br/>

                <div class="form-group">
                    <label for="generated_pass_phrase">Your generated pass phrase:</label>
                    <!-- <input type="text" class="form-control" id="generated_pass_phrase" value.bind="passphrase" readonly> -->
                    <div class="alert alert-info text-center" role="alert" style="font-size: 24px; word-spacing: 8px; line-height: 36px; padding-top: 12px; padding-bottom: 12px; margin: 0px;">
                        ${phrasePart1} <br/>
                        ${phrasePart2}
                    </div>
                </div>

                This phrase is used to derive HTH keys and addresses. All the keys and addresses generated from it can be recovered or imported
                (by using only this phrase), from any wallet that supports the BIP44 standard. This is the only backup you need. You
                should <strong>never</strong> entrust any 3rd party with this information, including us.
                <br/><br/>

                <strong>Before proceeding, make copy this pass phrase and store it somewhere safe. With it, you can always recover your wallet from any machine or device.</strong>
                <br/><br/>

                <div class="form-check ">
                    <label class="form-check-label">
                        <input class="form-check-input" type="checkbox" checked.bind="understood">
                        I understand
                    </label>
                </div>
                <br/>

            </div>

            <div if.bind="isGeneratingNewWallet" style="padding-top: 8px;">
                <button type="submit" class="btn btn-secondary ${isGenerationParamsValid ? '' : 'disabled'}" click.delegate="generateNewWallet()" disabled.bind="!isGenerationParamsValid">Generate wallet</button>
                <button type="button" class="btn btn-secondary  ${!understood ? 'disabled' : ''}" click.delegate="showTermsAndConditions()" show.bind="isGenerationParamsValid && walletGenerationAttempted && walletGenerationSucceeded" disabled.bind="!understood">Proceed to wallet</button>
            </div>

            <div show.bind="!walletGenerationSucceeded">
                <div class="alert alert-danger" role="alert" show.bind="walletGenerationAttempted && !walletGenerationSucceeded">Failed to generate wallet :(</div>
            </div>

            <div if.bind="isRecoveringExistingWallet" style="padding-top: 8px;">
                <div class="alert alert-success" role="alert" show.bind="walletRecoveryAttempted && walletRecoverySucceeded">
                    Wallet can be successfully recovered!<br/><br/>
                    Note that the initial import of your addresses (on the next screen) may take a while to complete. This is due to the fact that the blockchain
                    has to be scanned for historic transactions for those addresses, in order for your balance to be determined. We are currently working on enhancements
                    that will bring significant improvements to this aspect of the wallet, and hope to introduce them soon.
                </div>
                <div class="alert alert-danger" role="alert" show.bind="walletRecoveryAttempted && !walletRecoverySucceeded">Wallet cannot be recovered :(</div>
                <button type="submit" class="btn btn-secondary ${isRecoveryParamsValid ? '' : 'disabled'}" click.delegate="recoverWallet()" disabled.bind="!isRecoveryParamsValid">Recover wallet</button>
                <button type="button" class="btn btn-secondary" click.delegate="showTermsAndConditions()" show.bind="walletRecoveryAttempted && walletRecoverySucceeded">Proceed to wallet</button>
            </div>

        </form>

        <!-- <button type="submit" class="btn btn-secondary" click.delegate="showAdditionalWalletInfo()">Show additional wallet information</button> -->
        <div show.bind="isWalletDataAvailable && showWalletDetails">

            <br/>
            <h5>Additional wallet information</h5>
            <br/>

            <form>
                <div class="form-group row">
                    <label for="address1" class="col-sm-2 col-form-label">Address 1</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="address1" value.bind="wallet.addresses[0].address" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="privkey1" class="col-sm-2 col-form-label">Private Key 1</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="privkey1" value.bind="wallet.addresses[0].privkey" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="derivation_path" class="col-sm-2 col-form-label">Derivation Path</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="derivation_path" value.bind="wallet.derivationPath" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="bip32_root_key" class="col-sm-2 col-form-label">BIP32 Root Key</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="bip32_root_key" value.bind="wallet.bip32RootKey" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="bip32_ext_key" class="col-sm-2 col-form-label">BIP32 Ext Key</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="bip32_ext_key" value.bind="wallet.bip32ExtendedKey" readonly>
                    </div>
                </div>
            </form>

        </div>

    </div>

    <div id="passphrase_help_content" style='display:none'>
        <div class="card border-dark">
            <div class="card-header">Pass Phrase</div>
            <div class="card-body text-dark">
                <p class="card-text">
                    A <strong>pass phrase</strong> that you have from a previously generated wallet, used to recover that wallet's addresses
                    and keys.
                </p>
            </div>
        </div>
    </div>

    <div id="password_help_content" style='display:none'>
        <div class="card border-dark">
            <div class="card-header">Password</div>
            <div class="card-body text-dark">
                <p class="card-text">
                    A required password. It needs to be at least 8 characters long. This is in addition to the <strong>pass phrase</strong>
                    that is generated for you. While the pass phrase is used to derive keys and addresses, the password is used to
                    further encrypt your data in the browser, and manage access to the application. When the application is loaded again
                    after closing the browser, you will have to enter this password to proceed. The password is not stored in your browser,
                    and cannot be recovered. The incorrect password will simply not be able to decrypt your data and is therefore would be
                    unable to unlock the wallet.
                </p>
            </div>
        </div>
    </div>

    <modal-dialog name="termsAndConditions">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12">

                    <pHelp The Homeless Coin does not hold your keys for you. We cannot access accounts, recover keys, nor reverse
                    transactions. Protect your keys and always check that you are accessing the application on the correct
                    URL. You are responsible for your security.</p>

                    <p>This software functions as a free digital wallet. The software does not constitute an account where
                    Help The Homeless Coin or other third parties serve as financial intermediaries or custodians of your HTH.</p>

                    <p>While the software has undergone testing and continues to be improved by feedback from the
                    user and developer community, we cannot guarantee that there will be no bugs in the software.
                    You acknowledge that your use of this software is at your own discretion and in compliance with all
                    applicable laws.</p>

                    <p>You are responsible for safekeeping your passwords, private key pairs, recovery keys, PINs and any
                    other codes you use to access the software. IF YOU LOSE ACCESS TO YOUR HELP THE HOMELESS COIN WALLET OR YOUR
                    ENCRYPTED PRIVATE KEYS AND YOU HAVE NOT SEPARATELY STORED A BACKUP OF IT, YOU ACKNOWLEDGE AND AGREE
                    THAT ANY HTH YOU HAVE ASSOCIATED WITH THAT WALLET WILL BECOME INACCESSIBLE. All transaction requests
                    are irreversible.</p>

                    <p>The authors of the software, employees and affiliates of Help The Homeless Coin cannot retrieve your private keys or
                    passwords if you lose or forget them and cannot guarantee transaction confirmation as they do not have
                    control over the Help The Homeless Coin network. To the fullest extent permitted by law, this software is provided
                    “as is” and no representations or warranties can be made of any kind, express or implied, including but
                    not limited to the warranties of merchantability, fitness or a particular purpose and noninfringement.</p>

                    <p>You assume any and all risks associated with the use of the software. In no event shall the authors of the
                    software, employees and affiliates of Help The Homeless Coin and copyright holders be held liable for any claim, damages
                    or other liability, whether in an action of contract, tort, or otherwise, arising from, out of or in
                    connection with the software. We reserve the right to modify this disclaimer from time to time.</p>

                </div>
            </div>
        </div>
    </modal-dialog>

</template>
